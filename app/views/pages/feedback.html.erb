<div id="feedback-page" class="feedback-page app-page">

    <div class="page-header">
        <h1>Thanks for your order!</h1>
    </div>

    <div class="container mt-4">

        <h4>Order Summary</h4>
        <div class="order-summary-list">
            <div class="order-grid">
                <% @order.order_items.each do |order_item| %>
                <span class="order-item"><%= "#{order_item.item.name} x#{order_item.quantity}" %></span>
                <span class="order-price"><%= "$#{order_item.total_cost_formatted}" %></span>
                <% end %>
            </div>
        </div>


        <span class="scroll-indicator">
            <i class="material-icons">keyboard_arrow_down</i>
        </span>

        <div class="order-total-gratuity">
            <div class="left-cell">
                <p>Order: <strong><%= "$#{@order.total_cost_formatted}" %></strong></p>
                <p>Tip: <strong><%= "$#{@order.gratuity_amount_formatted}" %></strong></p>
            </div>
            <i class="arrow-icon material-icons">chevron_right</i>
            <div class="right-cell"><%="$#{@order.total_cost_with_gratuity_formatted}" %></div>
            <div class="badge-cell order-paid-badge"><span>Paid!<span></div>
        </div>

        <hr>

        <div class="ratings-section mt-4">
            <h4>How'd we do?</h4>

            <div class="ratings-stars">
                <div class="stars-flex">
                    <button type="button" class="btn btn-primary bmd-btn-icon">
                        <i class="material-icons">grade</i>
                    </button>
                    <button type="button" class="btn btn-primary bmd-btn-icon">
                        <i class="material-icons">grade</i>
                    </button>
                    <button type="button" class="btn btn-primary bmd-btn-icon">
                        <i class="material-icons">grade</i>
                    </button>
                    <button type="button" class="btn btn-primary bmd-btn-icon">
                        <i class="material-icons">grade</i>
                    </button>
                    <button type="button" class="btn btn-primary bmd-btn-icon">
                        <i class="material-icons">grade</i>
                    </button>
                </div>
            </div>

            <div class="bmd-form mt-2 mx-2 text-center">
                <textarea id="feedback-text" class="feedback-textarea form-control" rows="3"
                    placeholder="Write us a note!"></textarea>
                <button type="button" class="mt-1 btn-large btn btn-primary">Submit Feedback</button>
            </div>

        </div>

        <div class="page-footer container">
            <hr class="footer-divider">

            <div class="text-center mt-2">
                <p>Did you enjoy your ordering experience?</p>
                <button type="button" class="btn btn-raised btn-success btn-lg">Recommend Us</button>
                <button type="button" id="new-order-button" class="text-center btn btn-primary">Place Another Order</button>
            </div>
        </div>
    </div>

    <script>
        // Determines if the passed element is overflowing its bounds,
        // either vertically or horizontally.
        // Will temporarily modify the "overflow" style to detect this
        // if necessary.
        // https://stackoverflow.com/questions/143815/determine-if-an-html-elements-content-overflows
        function checkOverflow(el) {
            var curOverflow = el.style.overflow;

            if (!curOverflow || curOverflow === "visible")
                el.style.overflow = "hidden";

            var isOverflowing = el.clientWidth < el.scrollWidth ||
                el.clientHeight < el.scrollHeight;

            el.style.overflow = curOverflow;

            return isOverflowing;
        }

        document.addEventListener('DOMContentLoaded', (_event) => {
            const list = document.querySelector('.order-summary-list');
            if (checkOverflow(list.querySelector('.order-grid'))) {
                console.log('im visible');
                document.querySelector('.scroll-indicator').classList.toggle('is-visible');
                list.classList.toggle('.has-overflow');
            } else {
                // hr only visible if no overflow (gradient provides boundary when overflow)
                document.querySelector('.order-summary-divider').classList.toggle('is-visible');
            }
        });
    </script>