<div class="order-summary">

    <div class="order-title">
        <h1>Your order</h1>
    </div>

    <div class="order-summary-list order-container">
        <div class="order-grid">
            <% @cart_props[:items].each do |item| %>
            <!--<span class="order-row">-->
            <span class="order-item"><%= "#{item.title} x#{item.quantity}" %></span>
            <span class="order-price"><%= "$#{item.dollars}" %></span>
            <button type="button" class="order-action btn btn-danger bmd-btn-icon">
                <i class="material-icons">delete_outline</i>
            </button>
            <!--</span>-->
            <% end %>
        </div>      
    </div>

    <span class="scroll-indicator">
        <i class="material-icons">keyboard_arrow_down</i>
    </span>

    <div class="order-footer order-container">
        <hr class="order-summary-divider">

        <span class="order-total">
            <h2 class="order-total-text">Total</h2>
            <h2 class="order-total-amount">$<%= @cart_props[:total] %></h2>
        </span>

        <span class="order-buttons btn-group-lg">
            <button type="button" class="btn btn-raised btn-secondary">Back</button>
            <button type="button" class="btn btn-raised btn-success">Confirm Order</button>
        </span>
    </div>
</div>

<script>
    // Determines if the passed element is overflowing its bounds,
    // either vertically or horizontally.
    // Will temporarily modify the "overflow" style to detect this
    // if necessary.
    // https://stackoverflow.com/questions/143815/determine-if-an-html-elements-content-overflows
    function checkOverflow(el) {
        var curOverflow = el.style.overflow;

        if (!curOverflow || curOverflow === "visible")
            el.style.overflow = "hidden";

        var isOverflowing = el.clientWidth < el.scrollWidth ||
            el.clientHeight < el.scrollHeight;

        el.style.overflow = curOverflow;

        return isOverflowing;
    }

    document.addEventListener('DOMContentLoaded', (_event) => {
        const list = document.querySelector('.order-summary-list');
        if (checkOverflow(list.querySelector('.order-grid'))) {
            console.log('im visible');
            document.querySelector('.scroll-indicator').classList.toggle('is-visible');
            list.classList.toggle('.has-overflow');
        } else {
            // hr only visible if no overflow (gradient provides boundary when overflow)
            document.querySelector('.order-summary-divider').classList.toggle('is-visible');
        }

        // size to fit page
        const header = document.querySelector('.order-title').offsetHeight;
        const footer = document.querySelector('.order-footer').offsetHeight;
        const page = document.querySelector('.order-summary').offsetHeight;

        usedHeight = header + footer; 

        list.style.height = `${(page - usedHeight) * 0.9}px`;
        // console.log((page - usedHeight) * 0.9); 
    });
</script>